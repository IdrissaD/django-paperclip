{% load i18n attachments_tags thumbnail static %}
{% load url from future %}

{% get_attachments_for object as "attachments_list" %}

{% if attachments_list %}
    <table class="table">
        <thead>
            <th>{% trans "Filename" %}</th>
            <th>{% trans "Legend" %}</th>
            <th>{% trans "Author" %}</th>
            <th>{% trans "Insertion date" %}</th>
            <th>{% trans "Update date" %}</th>
            {% if can_delete_attachment %}
                <th>{% trans "Actions" %}</th>
            {% endif %}
        </thead>
        <tbody>
        {% for att in attachments_list %}
        <tr>
            <td>
                <a href="{{ att.attachment_file.url }}" target="_blank">
                    {% if att.is_image %}
                        <img class="img-polaroid" src="{{ att.attachment_file|thumbnail_url:'thumbnail' }}" alt="{{ att.title|default:att.filename }}" title="{{ att.title|default:att.filename }}">
                    {% else %}
                        <img src="{% get_static_prefix %}paperclip/fileicons/{{ att|icon_name }}.png"/>&nbsp;{{ att.title|default:att.filename }}
                    {% endif %}
                </a>
            </td>
            <td>{{ att.legend }}</td>
            <td>{{ att.author }}</td>
            <td>{{ att.date_insert }}</td>
            <td>{{ att.date_update }}</td>
            {% if can_delete_attachment %}
                <th><a class="delete-action" data-id="{{ att.pk }}" data-title="{{ att.title|default:att.pk }}" href="#">
                    {% trans "Delete" %}
                </a></th>
            {% endif %}
        </tr>
        {% endfor %}
    </table>
{% else %}
    {% trans "No file attached" %}
{% endif %}

    <div id="confirm-delete-msg"></div>

    <script type="text/javascript">
        $('.delete-action').click(function (e) {
            e.preventDefault();
            confirmDelete($(this).data('id'), $(this).data('title'));
            return false;
        });

        function confirmDelete(id, title) {
            var url = "{% url 'delete_attachment' 0 %}?next={{ attachment_delete_next|urlencode }}".replace('0', id);
            $('#confirm-delete-msg').confirmModal({
                heading: '{% trans "Confirm file deletion" %}',
                body: '{% trans "Are you sure to delete this file {file} ?" %}'.replace('{file}', title),
                callback: function() {
                    window.location = url;
                }
             });
        }
    </script>
